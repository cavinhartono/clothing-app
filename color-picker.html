<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div class="container">
      <input type="file" id="img" onchange="handleImage()" />
      <input type="color" id="color" onchange="updateColor()" />
      <img id="previewImage" />
    </div>
    <script>
      function handleImage() {
        const input = document.querySelector("#img");
        const previewImage = document.querySelector("#previewImage");

        file = input.files[0];

        if (file) {
          const reader = new FileReader();

          reader.onload = function (e) {
            previewImage.src = e.target.result;
          };

          reader.readAsDataURL(file);
        }
      }

      function updateColor() {
        const previewImage = document.querySelector("#previewImage");
        const colorPicker = document.querySelector("#color");

        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");

        canvas.width = previewImage.width;
        canvas.height = previewImage.height;

        context.drawImage(previewImage, 0, 0, canvas.width, canvas.height);

        const imageData = context.getImageData(
          previewImage,
          0,
          0,
          canvas.width,
          canvas.height
        ).data;

        let r = 0,
          g = 0,
          b = 0;

        for (let i = 0; i < imageData.length; i += 4) {
          r += imageData[i];
          g += imageData[i + 1];
          b += imageData[i + 2];
        }

        const avgR = Math.round(r / (imageData.length / 4));
        const avgG = Math.round(g / (imageData.length / 4));
        const avgB = Math.round(b / (imageData.length / 4));

        colorPicker.value = `rgb(${avgR}, ${avgG}, ${avgB})`;
      }
    </script>
  </body>
</html>
